{% extends 'base.html' %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-white p-4 rounded-xl shadow-lg col-span-1 border border-gray-100">
        <h2 class="text-xl font-bold text-green-800 mb-4 flex items-center">
            <i class="fa-solid fa-seedling mr-2"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤ (‡∏û‡∏∞‡πÄ‡∏¢‡∏≤)
        </h2>
        <div id="fieldList" class="space-y-4 overflow-y-auto max-h-[650px] pr-2">
            <p class="text-gray-500 text-center py-10">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
    </div>

    <div class="col-span-1 md:col-span-2 bg-white p-4 rounded-xl shadow-lg border border-gray-100">
        <div class="flex justify-between items-center mb-3">
            <h2 class="text-xl font-bold text-gray-800 flex items-center">
                <i class="fa-solid fa-map-location-dot mr-2"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏©‡∏ï‡∏£
            </h2>
            <div class="flex items-center space-x-2">
                <span class="text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded-full font-bold">ONLINE</span>
                <span class="text-[10px] bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-bold">üìç ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏û‡∏∞‡πÄ‡∏¢‡∏≤</span>
            </div>
        </div>
        <div id="map" class="map-container border border-gray-200 h-[550px] rounded-xl overflow-hidden shadow-inner"></div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
    var googleHybrid = L.tileLayer('https://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
        maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Google Hybrid'
    });
    var googleSat = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Google Satellite'
    });
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19, attribution: 'OpenStreetMap'
    });

    var map = L.map('map', { center: [19.1667, 99.9000], zoom: 12, layers: [googleHybrid] });
    L.control.layers({ "‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏° + ‡∏ä‡∏∑‡πà‡∏≠": googleHybrid, "‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°‡∏•‡πâ‡∏ß‡∏ô": googleSat, "‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏ô‡∏ô": osm }).addTo(map);

    var drawnItems = new L.FeatureGroup().addTo(map);
    map.addControl(new L.Control.Draw({
        draw: { polygon: true, rectangle: true, marker: false, circle: false, polyline: false }
    }));

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (Locate Me) ---
    var LocateControl = L.Control.extend({
        options: { position: 'topright' },
        onAdd: function (map) {
            var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
            container.style.backgroundColor = 'white';
            container.style.width = '34px';
            container.style.height = '34px';
            container.style.display = 'flex';
            container.style.alignItems = 'center';
            container.style.justifyContent = 'center';
            container.style.cursor = 'pointer';
            container.innerHTML = '<i class="fa-solid fa-location-crosshairs text-blue-600 text-lg"></i>';
            container.title = "‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô";
            container.onclick = function() { map.locate({setView: true, maxZoom: 16}); };
            return container;
        }
    });
    map.addControl(new LocateControl());

    map.on('locationfound', function(e) {
        if (window.currentPosMarker) map.removeLayer(window.currentPosMarker);
        window.currentPosMarker = L.marker(e.latlng).addTo(map).bindPopup("‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà").openPopup();
    });

    map.on('locationerror', function(e) {
        Swal.fire('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', '‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏õ‡∏¥‡∏î GPS ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á', 'error');
    });

    // 2. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞ Pop-up ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    map.on(L.Draw.Event.CREATED, function (e) {
        var layer = e.layer;
        var center = layer.getBounds().getCenter();
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏û‡∏∞‡πÄ‡∏¢‡∏≤
        if (center.lng < 99.80 || center.lng > 100.10 || center.lat < 19.00 || center.lat > 19.35) {
            Swal.fire({ icon: 'error', title: '‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà!', text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏î‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤‡∏†‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏û‡∏∞‡πÄ‡∏¢‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô' });
            return;
        }

        Swal.fire({
            title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤‡πÉ‡∏´‡∏°‡πà',
            icon: 'question',
            html: `
                <div class="text-left space-y-3 p-2">
                    <div>
                        <label class="text-xs font-bold text-gray-600">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤ / ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á</label>
                        <input id="swal-name" class="swal2-input !m-0 !w-full" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤‡∏•‡∏∏‡∏á‡πÅ‡∏î‡∏á 1">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-600">‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏Ç‡πâ‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å</label>
                        <select id="swal-variety" class="swal2-input !m-0 !w-full">
                            <option value="KDML105">‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ 105</option>
                            <option value="RD6">‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß ‡∏Å‡∏Ç 6</option>
                            <option value="RD15">‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ ‡∏Å‡∏Ç 15</option>
                            <option value="PT105">‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏≠‡∏°‡∏°‡∏∞‡∏•‡∏¥ ‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ 105</option>
                            <option value="other">‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                        </select>
                    </div>
                </div>
            `,
            showCancelButton: true,
            confirmButtonText: '<i class="fa-solid fa-save mr-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
            confirmButtonColor: '#16a34a',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
            preConfirm: () => {
                const name = document.getElementById('swal-name').value;
                if (!name) return Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤');
                return { name: name, variety: document.getElementById('swal-variety').value };
            }
        }).then((result) => {
            if (result.isConfirmed) {
                saveField(result.value.name, layer.toGeoJSON().geometry, result.value.variety);
                drawnItems.addLayer(layer);
            } else { map.removeLayer(layer); }
        });
    });

    async function saveField(name, geom, variety) {
        const response = await fetch('/api/rice-fields/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'X-CSRFToken': csrftoken},
            body: JSON.stringify({name, geometry: geom, variety})
        });
        if(response.ok) {
            Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', showConfirmButton: false, timer: 1500 });
            loadFields();
        }
    }

    // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö
    async function loadFields() {
        const res = await fetch('/api/rice-fields/');
        const data = await res.json();
        const div = document.getElementById('fieldList');
        div.innerHTML = '';
        drawnItems.clearLayers();
        
        data.forEach(f => {
            div.innerHTML += `
                <div class="relative group bg-white border border-gray-100 p-4 rounded-xl shadow-sm hover:shadow-md transition-all duration-300">
                    <button onclick="deleteField(${f.id}, '${f.name}')" class="absolute top-3 right-3 text-gray-300 hover:text-red-500 transition-colors">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>

                    <div class="flex flex-col">
                        <span class="text-lg font-bold text-gray-800">${f.name}</span>
                        <div class="flex items-center space-x-2 mt-1">
                            <span class="text-[11px] bg-green-50 text-green-700 px-2 py-0.5 rounded border border-green-100">${f.variety_display}</span>
                            <span class="text-[11px] bg-blue-50 text-blue-700 px-2 py-0.5 rounded border border-blue-100">${f.area_rai} ‡πÑ‡∏£‡πà</span>
                        </div>
                    </div>
                    
                    <div id="yield-info-${f.id}" class="my-3 p-3 bg-gray-50 rounded-lg border border-dashed border-gray-200">
                        <p class="text-[11px] text-gray-400 italic text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå NDVI</p>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mt-1">
                        <button onclick="calcYield(${f.id})" class="flex items-center justify-center bg-orange-500 hover:bg-orange-600 text-white text-xs font-bold py-2 rounded-lg transition-all">
                            <i class="fa-solid fa-satellite mr-1"></i> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                        </button>
                        <button onclick="notifySale(${f.id}, '${f.name}')" class="flex items-center justify-center bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-2 rounded-lg transition-all">
                            <i class="fa-solid fa-comment-dollar mr-1"></i> ‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≤‡∏¢
                        </button>
                    </div>
                </div>
            `;
            if(f.boundary) {
                L.geoJSON(JSON.parse(f.boundary), {
                    style: { color: "#16a34a", weight: 2, fillOpacity: 0.1 }
                }).bindPopup(`<b>${f.name}</b>`).addTo(map).addTo(drawnItems);
            }
        });
    }

    // 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤
    window.deleteField = function(id, name) {
        Swal.fire({
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
            text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤ "${name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        }).then(async (result) => {
            if (result.isConfirmed) {
                const res = await fetch(`/api/rice-fields/${id}/`, {
                    method: 'DELETE',
                    headers: {'X-CSRFToken': csrftoken}
                });
                if (res.ok) {
                    Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß!', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡∏≤‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', 'success');
                    loadFields();
                }
            }
        });
    }

    // 5. Pop-up ‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≤‡∏¢‡πÇ‡∏â‡∏°‡πÉ‡∏´‡∏°‡πà
    window.notifySale = function(fieldId, fieldName) {
        Swal.fire({
            title: 'üì¢ ‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≤‡∏¢‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï',
            text: fieldName,
            html: `
                <div class="text-left space-y-4 p-2">
                    <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 mb-4 text-blue-800 text-xs">
                        <i class="fa-solid fa-circle-info mr-1"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏£‡∏á‡∏™‡∏µ‡πÉ‡∏ô ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏û‡∏∞‡πÄ‡∏¢‡∏≤
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-600">‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏Ç‡πâ‡∏≤‡∏ß (‡∏ï‡∏±‡∏ô)</label>
                        <input id="sale-qty" type="number" class="swal2-input !m-0 !w-full" placeholder="0.00">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-600">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏™‡∏ô‡∏≠‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó/‡∏ï‡∏±‡∏ô)</label>
                        <input id="sale-price" type="number" class="swal2-input !m-0 !w-full" placeholder="‡πÄ‡∏ä‡πà‡∏ô 12000">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-600">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
                        <input id="sale-phone" type="text" class="swal2-input !m-0 !w-full" placeholder="08x-xxxxxxx">
                    </div>
                </div>
            `,
            confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
            confirmButtonColor: '#16a34a',
            showCancelButton: true,
            preConfirm: () => {
                const qty = document.getElementById('sale-qty').value;
                const price = document.getElementById('sale-price').value;
                const phone = document.getElementById('sale-phone').value;
                if (!qty || !price || !phone) return Swal.showValidationMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return { rice_field: fieldId, quantity_ton: qty, price_per_ton: price, phone: phone }
            }
        }).then(async (result) => {
            if(result.isConfirmed) {
                const res = await fetch('/api/sales/', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json', 'X-CSRFToken': csrftoken},
                    body: JSON.stringify(result.value)
                });
                if(res.ok) Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏à‡πâ‡∏á‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
        });
    }

    // 6. ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå NDVI
    window.calcYield = async function(id) {
        Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏≤‡∏ß‡πÄ‡∏ó‡∏µ‡∏¢‡∏°...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
        const res = await fetch(`/api/rice-fields/${id}/calculate_yield/`, {
            method: 'POST',
            headers: {'X-CSRFToken': csrftoken}
        });
        const data = await res.js‡∏£‡∏≤on();
        if(res.ok) {
            Swal.fire({
                title: '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                icon: 'success',
                html: `<div class="p-3 bg-green-50 rounded text-left">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå NDVI: <b>${data.ndvi.toFixed(3)}</b><br>‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï: <b class="text-lg text-green-700">${data.yield_ton.toFixed(2)} ‡∏ï‡∏±‡∏ô</b></div>`
            });
            document.getElementById(`yield-info-${id}`).innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-[11px] font-bold text-green-700"><i class="fa-solid fa-leaf mr-1"></i> NDVI: ${data.ndvi.toFixed(3)}</span>
                    <span class="text-[11px] font-bold text-orange-700"><i class="fa-solid fa-weight-hanging mr-1"></i> ${data.yield_ton.toFixed(2)} ‡∏ï‡∏±‡∏ô</span>
                </div>
            `;
        } else { Swal.fire('Error', data.error, 'error'); }
    }

    loadFields();
</script>

<style>
    .swal2-input { box-shadow: none !important; border: 1px solid #e5e7eb !important; border-radius: 8px !important; font-size: 14px !important; height: 42px !important; }
    .swal2-input:focus { border-color: #16a34a !important; box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.1) !important; }
    .swal2-popup { border-radius: 15px !important; padding: 1.5rem !important; }
    .leaflet-control-custom { border: none !important; box-shadow: 0 1px 5px rgba(0,0,0,0.4) !important; border-radius: 4px !important; }
</style>
{% endblock %}